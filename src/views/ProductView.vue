<template lang="pug">
.product.flex.justify-content.flex-column
  .product-maine-info.flex.flex-column
    .product-name
      h1 {{ findById(getID).name }}
    .product-info-container.flex
      .product-photo(
        :style="{'background-image':'url('+require('../assets/img/'+findById(getID).image)+')'}")
      .product-buying-info
        .product-price.flex.flex-center
          p price:
          h2 {{ findById(getID).price }} $
        .product-quantity.flex.flex-start
          p quantity:
          h2 {{ findById(getID).quantity }}
        .buy-form.cart-buy.flex.align-center.space-between
          .btn.buy-btn(@click='buyProduct(getID)') buy
          .btn.cart-btn(@click='reduceProductsQuantity(getID)') add to cart
        .payment-delivery.flex.space-between.align-center
          .link(@click='enableDeliveryInfo=!enableDeliveryInfo') delivery
          .link(@click='enablePayInfo=!enablePayInfo') payment
  .product-description.flex
    .product-text
      .product-text-head.flex.align-center
        h2 {{ findById(getID).name }} description
      .product-text-body
        p {{ findById(getID).description }}
    DeliveryInfo(v-if='enableDeliveryInfo'
      @close-window='enableDeliveryInfo = false')
    PayInfo(v-if='enablePayInfo'
      @close-window='enablePayInfo = false')
    NoProduct(v-if='getEnableNoProduct'
    @window-close='changeEnableNoProduct')
</template>

<script lang="ts">
import { Getter, Mutation } from 'vuex-class';
import { Options, Vue } from 'vue-class-component';
import DeliveryInfo from '../components/Modal/DeliveryInfo.vue';
import PayInfo from '../components/Modal/PayInfo.vue';
import { ProductsInterface } from '../types';

@Options({
  components: {
    DeliveryInfo,
    PayInfo,
  },
})

export default class ProductView extends Vue {
  @Getter getEnableNoProduct!: boolean;

  @Mutation changeEnableNoProduct:any;

  @Mutation reduceProductsQuantity: any;

  @Getter getProducts!: ProductsInterface[];

  @Getter getID!: number;

  enableDeliveryInfo = false;

  enablePayInfo = false;

  findById(ID:number) {
    return this.getProducts.find((x) => x.id === ID);
  }

  buyProduct(i:number) {
    if (this.checkProductQuantity(i)) return (this.$router.push({ name: 'Cart' }) && this.reduceProductsQuantity(i));
    // eslint-disable-next-line
    else return this.changeEnableNoProduct();
  }

  checkProductQuantity(ID:number) {
    const index = this.getProducts.findIndex((obj) => obj.id === ID);
    console.log(this.getProducts[index].quantity);
    if (this.getProducts[index].quantity > 0) return true; // eslint-disable-next-line
    else return false;
  }
}

</script>

<style lang="scss" scoped>
@import '../assets/style.scss';

.product{
  width: 100%;
  height: 100%;
  background: linear-gradient(#deeef5, #eff3e1);}
  .product-maine-info{
    width: 100%;
    height: auto;
    padding: 30px;}
    .product-name{
      width: 100%;
      height: 80px;
      padding: 10px 10px 20px 10px;}
      .product-name h1{
        text-align: center;
        font-size: 2em;
        color: $black-color;}
    .product-info-container{
      @include mq('phone-wide'){
        flex-direction: column; }
    }
    .product-photo{
      width: 50%;
      height: 400px;
      background-image: url('../assets/img/mobile.png');
      background-size: contain;
      background-repeat: no-repeat;
      @include mq('phone-wide'){
        width: 100%; }}
    .product-buying-info{
      width: 50%;
      padding: 20px;
      @include mq('phone-wide'){
        width: 100%; }}
      .product-price{
        width: 100%;
        height: 70px;
        padding: 5px;}
        .product-price p{
          font-size: 1.3em;
          color: $black-color;
          margin-right: 10px;}
        .product-price h2{
          font-size: 2.5em;
          color: $green-color;
          @include mq('desktop'){
            font-size: 2.3em;
          }
          @include mq('tablet-wide'){
            font-size: 2.1em;
          }
          @include mq('tablet'){
            font-size: 1.9em;
          }
          @include mq('phone-wide'){
            font-size: 1.8em;
          }}
      .product-quantity{
        padding-left: 50px;
        @include mq('phone-wide'){
          padding-left: 20px;
        }}
      .cart-buy{
        @include mq('tablet-wide'){
          padding: 20px;
        }
        @include mq('tablet'){
          height: 140px;
          padding: 10px;
          flex-direction: column;
        }
        @include mq('phone-wide'){
          height: 80px;
          padding: 10px;
          flex-direction: row;
        }
      }
      .payment-delivery{
        height: 40px;
        padding: 10px 100px;
        @include mq('tablet-wide'){
          padding: 10px 80px;
        }
        @include mq('tablet'){
          padding: 10px 60px;
          flex-direction: column;
        }
        @include mq('phone-wide'){
          padding: 10px 40px;
          flex-direction: row;
        }}
        .link{
          height: 100%;
          width: auto;
          cursor: pointer;
          text-align: center;
          @include mq('tablet'){
            padding: 10px;
          }}
        .link:hover{
          color: $dark-blue-color;}
  .product-description{
    width: 100%;
    height: auto;}
    .product-text{
      width: 100%;
      height: auto;}
      .product-text-head{
        height: 50px;
        margin: 20px 0;
        background-color: rgb(189, 183, 183);}
        .product-text-head h2{
          height: 30px;
          font-size: 1.8em;
          font-weight: 500;
          text-align: left;
          margin: 30px 30px;}
      .product-text p{
        font-size: 1.2em;
        text-align: left;
        margin: 30px 30px;}
</style>
